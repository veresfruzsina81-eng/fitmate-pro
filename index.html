<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FitMate HU</title>
<style>
  :root{
    --bg: #0c1116;
    --card:#111826d9; /* √ºveges, de olvashat√≥ */
    --text:#e6eef6;
    --muted:#a9b4c0;
    --pink:#ff5aa5;
    --ring:#77d0ff;
    --ok:#76e0a6;
    --danger:#ff7b7b;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius:20px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  }
  /* h√°tt√©r */
  #bg{
    position:fixed;inset:0;background:#000 center/cover no-repeat;opacity:.35;z-index:-2;
    transition: background-image .4s ease, opacity .25s ease;
  }
  /* s√∂t√©t overlay hogy ne olvadjon bele a sz√∂veg */
  #shade{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.55));z-index:-1}

  .container{max-width:950px;margin:0 auto;padding:20px 16px 120px}

  h1,h2,h3{margin:0 0 10px}
  h1{font-size:38px;letter-spacing:.3px}
  h2{font-size:28px}
  p{margin:0 0 8px;color:var(--muted)}

  .card{
    background:var(--card);backdrop-filter: blur(10px);
    border:1px solid rgba(255,255,255,.08);
    border-radius:var(--radius);box-shadow:var(--shadow);
  }
  .pad{padding:18px}

  .btn{
    display:inline-flex;align-items:center;justify-content:center;
    height:48px;padding:0 20px;border-radius:999px;border:none;cursor:pointer;
    font-weight:700;background:var(--pink);color:#12141a;transition:transform .05s ease,opacity .2s;
  }
  .btn:active{transform:translateY(1px)}
  .btn.ghost{
    background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.16)
  }
  .row{display:flex;gap:16px;flex-wrap:wrap}
  .grid{display:grid;gap:14px}
  .menu{grid-template-columns:1fr}
  @media(min-width:720px){.menu{grid-template-columns:1fr 1fr}}

  .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.12)}

  .list-item{
    display:flex;gap:14px;align-items:center;padding:14px;border-radius:16px;background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.1);cursor:pointer
  }
  .thumb{width:72px;height:52px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.12)}
  .muted{color:var(--muted)}
  .select{height:44px;padding:0 14px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:#0f141b;color:var(--text)}

  /* ‚Äûn√©zetek‚Äù */
  .view{display:none}
  .view.show{display:block}

  /* Splash k√∂z√©pre */
  .centerbox{
    max-width:520px;margin:clamp(16px,15vh,180px) auto 0;
    text-align:center;padding:22px;border-radius:28px
  }

  /* fejl√©c vissza gomb */
  .backbar{display:flex;align-items:center;gap:12px;margin:8px 0 18px}
  .back{padding:10px 16px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);cursor:pointer}

  /* modal (gyakorlat r√©szletes) */
  .modal{
    position:fixed;inset:0;display:none;place-items:center;padding:20px;z-index:50;
    background:rgba(0,0,0,.55)
  }
  .modal.show{display:grid}
  .sheet{width:100%;max-width:880px}
  video{width:100%;height:auto;border-radius:16px;border:1px solid rgba(255,255,255,.12);background:#000}

  /* sz√°ml√°l√≥ blokk */
  .counter{
    background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);
    border-radius:20px;padding:16px;margin-top:14px
  }
  .kpi{font-size:56px;font-weight:800;letter-spacing:2px}
  .ok{color:var(--ok)} .danger{color:var(--danger)}
  .footer-space{height:80px}
</style>
</head>
<body>
<div id="bg"></div>
<div id="shade"></div>

<!-- SPLASH -->
<section id="view-splash" class="view show">
  <div class="container">
    <div class="card centerbox">
      <h1>FitMate <span style="color:var(--ring)">HU</span></h1>
      <p>Magyar fitnesz ‚Äì egyszer≈±en, sz√©pen, okosan.</p>
      <div style="margin-top:18px">
        <button id="btnStart" class="btn">Kezdj√ºk</button>
      </div>
    </div>
  </div>
</section>

<!-- C√âLV√ÅLASZT√ì -->
<section id="view-goal" class="view">
  <div class="container">
    <div class="backbar"><button class="back" data-go="splash">‚Üê Vissza</button></div>
    <h1>V√°laszd ki a c√©lod</h1>
    <p>Ezt k√©s≈ëbb b√°rmikor m√≥dos√≠thatod.</p>

    <div class="grid" style="margin-top:18px">
      <div class="list-item" data-goal="fogyas">
        <img class="thumb" src="./fogyas.png" alt="Fogy√°s" />
        <div><div style="font-weight:800">Fogy√°s</div><div class="muted">Zs√≠r√©get√©s, k√≠m√©letes temp√≥</div></div>
      </div>
      <div class="list-item" data-goal="szalkasitas">
        <img class="thumb" src="./szalkasitas.png" alt="Sz√°lk√°s√≠t√°s" />
        <div><div style="font-weight:800">Sz√°lk√°s√≠t√°s</div><div class="muted">Deficit + t√≥nusos izom</div></div>
      </div>
      <div class="list-item" data-goal="hizas">
        <img class="thumb" src="./hizas.png" alt="H√≠z√°s" />
        <div><div style="font-weight:800">H√≠z√°s</div><div class="muted">Izomt√∂meg n√∂vel√©s, szuficit</div></div>
      </div>
    </div>

    <div class="row" style="margin-top:16px">
      <div class="pill">Nem:
        <select id="gender" class="select" style="margin-left:10px">
          <option value="no">N≈ë</option>
          <option value="ferfi">F√©rfi</option>
        </select>
      </div>
      <button id="btnToMenu" class="btn">Tov√°bb a f≈ëmen√ºbe</button>
    </div>
  </div>
</section>

<!-- F≈êMEN√ú -->
<section id="view-menu" class="view">
  <div class="container">
    <div class="backbar"><button class="back" data-go="goal">‚Üê Vissza</button></div>
    <div class="row" style="align-items:center;justify-content:space-between">
      <div class="pill">√údv! <strong id="stateGoal" style="margin-left:8px">C√©l: ‚Äì</strong></div>
      <div class="row">
        <button class="btn ghost" data-go="goal">C√©l m√≥dos√≠t√°sa</button>
        <button class="btn ghost" data-go="splash">Kezd≈ë</button>
      </div>
    </div>

    <div class="grid menu" style="margin-top:18px">
      <div class="card pad" data-go="workouts">
        <h2>Edz√©s</h2><p>Kateg√≥ria szerinti lista, id≈ëz√≠t≈ëvel.</p>
      </div>
      <div class="card pad" data-go="cal">
        <h2>Kal√≥riasz√°ml√°l√≥</h2><p>Egyszer≈± napi bevitel.</p>
      </div>
      <div class="card pad" data-go="perf">
        <h2>Napi teljes√≠tm√©ny</h2><p>Streak √©s k√©sz napok.</p>
      </div>
      <div class="card pad" data-go="chat">
        <h2>AI chat</h2><p>Magyar tan√°csok.</p>
      </div>
    </div>
  </div>
</section>

<!-- EDZ√âS LISTA -->
<section id="view-workouts" class="view">
  <div class="container">
    <div class="backbar"><button class="back" data-go="menu">‚Üê Vissza</button><h2 style="margin:0">Napi edz√©s</h2></div>
    <p>V√°lassz gyakorlatot a c√©lod alapj√°n (5 db / kateg√≥ria).</p>

    <div id="workoutList" class="grid" style="margin-top:14px"></div>
    <div class="footer-space"></div>
  </div>
</section>

<!-- KAL√ìRIASZ√ÅML√ÅL√ì (egyszer≈±) -->
<section id="view-cal" class="view">
  <div class="container">
    <div class="backbar"><button class="back" data-go="menu">‚Üê Vissza</button><h2 style="margin:0">Kal√≥riasz√°ml√°l√≥</h2></div>
    <div class="card pad">
      <div class="row">
        <input id="mealName" class="select" style="flex:2" placeholder="√âtkez√©s (pl. csirkemell, rizs)" />
        <input id="mealKcal" class="select" style="flex:1" placeholder="kcal" type="number" />
        <button id="btnAddMeal" class="btn">Hozz√°ad</button>
      </div>
      <div id="mealList" class="grid" style="margin-top:12px"></div>
      <div class="pill" style="margin-top:12px">Napi √∂sszesen: <strong id="kcalSum" style="margin-left:6px">0 kcal</strong></div>
    </div>
  </div>
</section>

<!-- NAPI TELJES√çTM√âNY -->
<section id="view-perf" class="view">
  <div class="container">
    <div class="backbar"><button class="back" data-go="menu">‚Üê Vissza</button><h2 style="margin:0">Napi teljes√≠tm√©ny</h2></div>
    <div class="grid">
      <div class="card pad"><div class="muted">Folyamatos napok (streak)</div><h2 id="streak">0 nap</h2></div>
      <div class="card pad"><div class="muted">√ñsszes befejezett edz√©s</div><h2 id="doneCount">0</h2></div>
    </div>
    <p class="muted" style="margin-top:10px">Az √©rt√©kek a k√©sz√ºl√©keden t√°rol√≥dnak (LocalStorage).</p>
  </div>
</section>

<!-- AI CHAT (front-end) -->
<section id="view-chat" class="view">
  <div class="container">
    <div class="backbar"><button class="back" data-go="menu">‚Üê Vissza</button><h2 style="margin:0">AI chat (magyar)</h2></div>
    <div class="card pad" style="min-height:320px">
      <div id="chatBox" class="card pad" style="min-height:180px;background:rgba(255,255,255,.03)">
        <div class="pill" style="float:right;background:var(--pink);color:#12141a">Szia</div>
        <p style="margin-top:40px">Szia! Miben seg√≠thetek a <span id="chatGoal">c√©lodban</span>?</p>
      </div>
      <div class="row" style="margin-top:12px">
        <input id="chatInput" class="select" style="flex:1" placeholder="√çrd ide a k√©rd√©sed..." />
        <button id="btnSend" class="btn">K√ºld√©s</button>
      </div>
      <p class="muted" style="margin-top:8px">Megjegyz√©s: a backend kulcskezel√©s Netlify functionban van. Ha nincs be√°ll√≠tva, itt minta v√°laszt kapsz.</p>
    </div>
  </div>
</section>

<!-- MODAL (GYAKORLAT R√âSZLET) -->
<div id="modal" class="modal">
  <div class="sheet card pad">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h2 id="exTitle" style="margin:0">Gyakorlat</h2>
      <button id="modalClose" class="btn ghost">‚úï</button>
    </div>
    <p id="exDesc" class="muted">Le√≠r√°s.</p>
    <video id="exVideo" playsinline muted loop autoplay></video>

    <div class="row" style="margin-top:12px">
      <div class="pill">K√∂r√∂k: <input id="inpSets" class="select" type="number" min="1" value="3" style="width:80px;margin-left:8px"></div>
      <div class="pill">Ism√©tl√©s/k√∂r: <input id="inpReps" class="select" type="number" min="1" value="12" style="width:90px;margin-left:8px"></div>
      <div class="pill">Id≈ë/ism. (mp): <input id="inpSec" class="select" type="number" min="1" value="2" style="width:90px;margin-left:8px"></div>
    </div>

    <div class="counter">
      <h2>K√©szen √°llsz?</h2>
      <div id="big" class="kpi">00:00</div>
      <div class="row" style="margin-top:8px">
        <button id="btnStartSet" class="btn">Start</button>
        <button id="btnPause" class="btn ghost">Sz√ºnet</button>
        <button id="btnNext" class="btn ghost">K√∂vetkez≈ë</button>
      </div>
      <p id="statusLine" class="muted" style="margin-top:8px"></p>
    </div>
  </div>
</div>

<script>
/* ===== KIS ‚ÄûROUTER‚Äù + √ÅLLAPOT ===== */
const S = {
  goal: localStorage.getItem('goal') || null,
  gender: localStorage.getItem('gender') || 'no',
  done: +(localStorage.getItem('done') || 0),
  streak: +(localStorage.getItem('streak') || 0),
  lastDoneDate: localStorage.getItem('lastDoneDate') || null
};
const qs = s=>document.querySelector(s);
const qsa = s=>[...document.querySelectorAll(s)];
function show(id){
  qsa('.view').forEach(v=>v.classList.remove('show'));
  qs('#view-'+id).classList.add('show');
  if(id==='menu'){ renderMenu(); }
  if(id==='workouts'){ renderWorkouts(); }
  if(id==='chat'){ qs('#chatGoal').textContent = S.goalHun||'c√©lodban'; }
  setBackgroundFor(id);
}
function setBackgroundFor(view){
  let url = 'url("./kezdo.png")';
  if(view==='goal' || view==='menu'){ // c√©lhoz ill≈ë header
    if(S.goal==='fogyas') url='url("./fogyas.png")';
    if(S.goal==='szalkasitas') url='url("./szalkasitas.png")';
    if(S.goal==='hizas') url='url("./hizas.png")';
  }else if(view==='workouts'){
    if(S.goal==='fogyas') url='url("./fogyas.png")';
    if(S.goal==='szalkasitas') url='url("./szalkasitas.png")';
    if(S.goal==='hizas') url='url("./hizas.png")';
  }else{
    url='url("./kezdo.png")';
  }
  const bg=qs('#bg'); bg.style.backgroundImage=url; bg.style.opacity=.35;
}

/* ===== SPLASH -> GOAL ===== */
qs('#btnStart').addEventListener('click',()=>show('goal'));

/* ===== GOAL UI ===== */
let tempGoal = S.goal || 'fogyas';
let tempGender = S.gender;
qsa('#view-goal .list-item').forEach(item=>{
  item.addEventListener('click',()=>{
    tempGoal = item.dataset.goal;
    qsa('#view-goal .list-item').forEach(i=>i.style.outline='none');
    item.style.outline = `2px solid var(--ring)`;
  });
});
qs('#gender').value = tempGender;
qs('#gender').addEventListener('change',e=> tempGender = e.target.value);
qs('#btnToMenu').addEventListener('click',()=>{
  S.goal = tempGoal; S.gender=tempGender;
  S.goalHun = ({fogyas:'Fogy√°s', szalkasitas:'Sz√°lk√°s√≠t√°s', hizas:'H√≠z√°s'})[S.goal] || '‚Äì';
  localStorage.setItem('goal',S.goal);
  localStorage.setItem('gender',S.gender);
  show('menu');
});

/* ===== F≈êMEN√ú KATT ===== */
qsa('#view-menu [data-go]').forEach(el=>el.addEventListener('click',()=>show(el.dataset.go)));
qsa('.back').forEach(b=>b.addEventListener('click',()=>show(b.dataset.go)));

/* ===== MEN√ú RENDER ===== */
function renderMenu(){
  qs('#stateGoal').textContent = `C√©l: ${S.goalHun||'‚Äì'}`;
}

/* ===== KAL√ìRIA SZ√ÅML√ÅL√ì ===== */
const M = {items: JSON.parse(localStorage.getItem('meals')||'[]')};
function saveMeals(){ localStorage.setItem('meals', JSON.stringify(M.items)); }
function renderMeals(){
  const wrap = qs('#mealList'); wrap.innerHTML='';
  let sum=0;
  M.items.forEach((m,i)=>{
    sum+=m.kcal;
    const row = document.createElement('div');
    row.className='list-item';
    row.innerHTML = `<div style="flex:1"><strong>${m.name}</strong><div class="muted">${m.kcal} kcal</div></div>
      <button class="btn ghost">T√∂rl√©s</button>`;
    row.querySelector('button').onclick=()=>{M.items.splice(i,1);saveMeals();renderMeals();}
    wrap.appendChild(row);
  });
  qs('#kcalSum').textContent = `${sum} kcal`;
}
qs('#btnAddMeal').onclick=()=>{
  const name = qs('#mealName').value.trim(); const kcal = +qs('#mealKcal').value||0;
  if(!name || !kcal) return;
  M.items.push({name,kcal}); saveMeals(); renderMeals();
  qs('#mealName').value=''; qs('#mealKcal').value='';
};
renderMeals();

/* ===== GYAKORLAT ADATOK (p√©lda ‚Äì ‚ÄûH√≠z√°s / otthoni‚Äù, F√©rfi & N≈ë) ===== */
const DATA = {
  hizas: {
    ferfi: [
      {t:'Cs√≠p≈ëemel√©s', f:'hizas1.mp4', d:'Far √©s h√°t als√≥ szakasz er≈ës√≠t√©se.'},
      {t:'N√©gy√ºtem≈± fekv≈ët√°masz', f:'hizas2.mp4', d:'Teljes test √°ll√≥k√©pess√©g, dinamika.'},
      {t:'Guggol√°s', f:'hizas3.mp4', d:'Klasszikus als√≥test; t√∂rzs feszes.'},
      {t:'Plank', f:'hizas4.mp4', d:'T√∂rzs stabiliz√°ci√≥, der√©k tehermentes√≠t√©se.'},
      {t:'H√≠d v√°ltott l√°bbal', f:'hizas5.mp4', d:'Glute bridge halad√≥ v√°ltozat.'},
    ],
    no: [
      {t:'Cs√≠p≈ëemel√©s', f:'hizas_w1.mp4', d:'Farizom, hamstring aktiv√°l√°s.'},
      {t:'N√©gy√ºtem≈± fekv≈ët√°masz', f:'hizas_w2.mp4', d:'Pulzus emel√©s + teljes test.'},
      {t:'Guggol√°s', f:'hizas_w3.mp4', d:'Saj√°t tests√∫lyos guggol√°s, t√©rd a l√°bfej ir√°ny√°ba.'},
      {t:'Plank', f:'hizas_w4.mp4', d:'K√∂ny√∂k a v√°ll alatt, t√∂rzs feszes.'},
      {t:'H√≠d v√°ltott l√°bbal', f:'hizas_w5.mp4', d:'Glute bridge v√°ltott l√°bemel√©ssel.'},
    ]
  },
  fogyas: { ferfi:[], no:[] },
  szalkasitas: { ferfi:[], no:[] }
};

/* ===== EDZ√âS LISTA ===== */
function renderWorkouts(){
  const list = qs('#workoutList'); list.innerHTML='';
  const items = (DATA[S.goal] && DATA[S.goal][S.gender]) || [];
  if(!items.length){
    list.innerHTML = `<div class="card pad"><h3>M√©g nincsenek vide√≥k ehhez a c√©lhoz.</h3><p class="muted">K√©s≈ëbb felt√∂ltj√ºk ≈ëket.</p></div>`;
    return;
  }
  items.forEach((it,idx)=>{
    const row = document.createElement('div');
    row.className='list-item';
    row.innerHTML = `
      <img class="thumb" src="./${S.goal}.png" alt="${S.goal}">
      <div style="flex:1">
        <div style="font-weight:800">#${idx+1}. gyakorlat</div>
        <div class="muted">${it.t}</div>
      </div>
      <button class="btn">Megnyit</button>`;
    row.querySelector('.btn').onclick = ()=> openExercise(it);
    list.appendChild(row);
  });
}

/* ===== MODAL + ID≈êZ√çT≈ê ===== */
const modal = qs('#modal');
const exVideo = qs('#exVideo');
let timer=null, paused=false;
let cur={sets:0,reps:0,sec:0, setNow:1, repNow:0};

function beep(){
  // kis ‚Äûbeep‚Äù WebAudio-val
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.type='sine'; o.frequency.value=880; g.gain.value=.06;
    o.start(); setTimeout(()=>{o.stop();ctx.close()},180);
  }catch(e){}
}

function openExercise(it){
  qs('#exTitle').textContent = it.t;
  qs('#exDesc').textContent = it.d || '';
  exVideo.src = `./${it.f}`; exVideo.play().catch(()=>{});
  qs('#inpSets').value=3; qs('#inpReps').value=12; qs('#inpSec').value=2;
  qs('#big').textContent='00:00'; qs('#statusLine').textContent='';
  modal.classList.add('show');
}
qs('#modalClose').onclick=()=>{ stopTimer(); modal.classList.remove('show'); exVideo.pause(); };

function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

qs('#btnStartSet').onclick=()=>{
  cur.sets = Math.max(1, +qs('#inpSets').value||1);
  cur.reps = Math.max(1, +qs('#inpReps').value||1);
  cur.sec  = Math.max(1, +qs('#inpSec').value||1);
  cur.setNow = 1; cur.repNow = 0; paused=false;
  runSet();
};

qs('#btnPause').onclick=()=>{ paused=!paused; qs('#btnPause').textContent = paused?'Folytat√°s':'Sz√ºnet'; };

qs('#btnNext').onclick=()=>{ // manu√°lis tov√°bbl√©p√©s
  stopTimer(); cur.setNow++; if(cur.setNow<=cur.sets){ restPhase(()=>runSet()); } else finishExercise();
};

function runSet(){
  stopTimer();
  qs('#statusLine').textContent = `K√∂r ${cur.setNow} / ${cur.sets} ‚Äî indul!`;
  cur.repNow = 0; let t=cur.sec;
  updateKPI(t);
  timer = setInterval(()=>{
    if(paused) return;
    t--; updateKPI(t);
    if(t<=0){
      cur.repNow++; beep();
      if(cur.repNow>=cur.reps){
        // k√∂r k√©sz
        stopTimer();
        cur.setNow++;
        if(cur.setNow<=cur.sets){
          restPhase(()=>runSet());
        }else{
          finishExercise();
        }
      }else{
        t=cur.sec; // k√∂vetkez≈ë ism√©tl√©s
        qs('#statusLine').textContent = `K√∂r ${cur.setNow} / ${cur.sets} ‚Äî ism√©tl√©s ${cur.repNow+1} / ${cur.reps}`;
      }
    }
  },1000);
}

function restPhase(cb){
  let r=15; qs('#statusLine').textContent=`Pihen≈ë ${r} mp`;
  updateKPI(r,true);
  const rint = setInterval(()=>{
    if(paused) return;
    r--; updateKPI(r,true);
    if(r<=0){ clearInterval(rint); beep(); cb(); }
  },1000);
}

function finishExercise(){
  qs('#statusLine').innerHTML = `<span class="ok">√úgyes vagy! üéâ Befejezt√ºk a k√∂rt.</span> L√©pj vissza √©s v√°laszd a k√∂vetkez≈ët.`;
  updateKPI(0);
  // teljes√≠tm√©ny sz√°ml√°l√≥
  S.done++; localStorage.setItem('done',S.done); qs('#doneCount').textContent=S.done;
  const today=(new Date()).toDateString();
  if(S.lastDoneDate!==today){ S.streak++; localStorage.setItem('streak',S.streak); localStorage.setItem('lastDoneDate',today); qs('#streak').textContent=S.streak+' nap'; }
}

function updateKPI(n,rest){
  const mm = String(Math.floor(n/60)).padStart(2,'0');
  const ss = String(n%60).padStart(2,'0');
  qs('#big').textContent = `${mm}:${ss}`;
  qs('#big').className = `kpi ${rest?'muted':''}`;
}

/* ===== CHAT (front: ha nincs backend, dummy v√°lasz) ===== */
qs('#btnSend').onclick = async ()=>{
  const q = qs('#chatInput').value.trim(); if(!q) return;
  const box = qs('#chatBox');
  const you = document.createElement('div'); you.className='pill'; you.style.cssText='float:right;background:var(--pink);color:#12141a;margin-top:8px'; you.textContent=q;
  box.appendChild(you);
  qs('#chatInput').value='';
  // pr√≥b√°ljuk megh√≠vni a Netlify functiont, ha nincs: fallback
  let reply = '';
  try{
    const r = await fetch('/.netlify/functions/ai-chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({goal:S.goal,gender:S.gender,question:q})});
    if(r.ok){ const j = await r.json(); reply = j.reply || ''; }
  }catch(e){}
  if(!reply){
    reply = `Itt lesz a szem√©lyre szabott v√°lasz. (C√©l: ${S.goalHun||'‚Äì'}, nem: ${S.gender==='no'?'n≈ë':'f√©rfi'})`;
  }
  const ai = document.createElement('div'); ai.className='card pad'; ai.style.cssText='margin-top:8px;background:rgba(255,255,255,.03)'; ai.textContent = reply;
  box.appendChild(ai);
  box.scrollTop = box.scrollHeight;
};

/* ===== INITIAL ===== */
(function init(){
  // failsafe ‚Äì ha valami√©rt itt √°lln√°nk, legal√°bb a splash->goal m≈±k√∂dj√∂n
  document.getElementById('btnStart')?.addEventListener('click',()=>show('goal'));
  if(localStorage.getItem('goal')){
    S.goalHun = ({fogyas:'Fogy√°s', szalkasitas:'Sz√°lk√°s√≠t√°s', hizas:'H√≠z√°s'})[localStorage.getItem('goal')] || '‚Äì';
    show('menu');
  }else{
    show('splash');
  }
  // alap KPI
  qs('#doneCount').textContent = S.done;
  qs('#streak').textContent = S.streak + ' nap';
})();
</script>
</body>
</html>
